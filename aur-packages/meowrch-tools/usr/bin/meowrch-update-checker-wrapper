#!/bin/bash

# Get username from first argument
USERNAME="$1"

if [ -z "$USERNAME" ]; then
    echo "Error: Username not provided"
    exit 1
fi

# Get user ID
USER_ID=$(id -u "$USERNAME")

# Set up basic environment
export XDG_RUNTIME_DIR="/run/user/$USER_ID"
export DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/$USER_ID/bus"

# Try to detect display environment
# For X11
export DISPLAY=":0"

# For Wayland - check for wayland socket
for wayland_socket in /run/user/$USER_ID/wayland-*; do
    if [ -S "$wayland_socket" ]; then
        export WAYLAND_DISPLAY="$(basename "$wayland_socket")"
        break
    fi
done

# Run the actual update checker
/usr/bin/update-meowrch check
